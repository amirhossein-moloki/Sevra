# Sevra Project - Development Roadmap & TODO (Production-Ready)

این سند نقشه راه پروژه Sevra را برای رسیدن به سطح **Level 4 (Production-Ready)** ترسیم می‌کند.

## ۱. ارزیابی فعلی کیفیت نرم‌افزار (Software Quality Assessment)

| شاخص | وضعیت | نمره (۱-۵) | توضیحات |
| :--- | :--- | :---: | :--- |
| **معماری** | MVP | ۳ | ساختار ماژولار و استفاده از الگوی Controller-Service-Repository به صورت نسبی (Inconsistent). جداسازی مسئولیت‌ها در اکثر موارد رعایت شده است. |
| **کدنویسی** | High Quality | ۴ | استفاده از TypeScript Strict Mode، Zod برای اعتبار‌سنجی و پینو برای لاگینگ. استانداردها به خوبی رعایت شده‌اند. |
| **تست** | Basic | ۲ | تست‌های واحد و E2E برای عملکردهای حیاتی (رزرو، همزمانی) وجود دارد، اما پوشش کلی (Coverage) پایین است. |
| **امنیت** | Solid | ۳ | RBAC، سیستم Idempotency، پاکسازی PII در لاگ‌ها و مدیریت خطای امن پیاده‌سازی شده‌اند. بخش Audit Log نیاز به تکمیل دارد. |
| **زیرساخت** | Ready for Scale | ۳ | CI/CD اولیه با GitHub Actions و لاگینگ ساختاریافته وجود دارد. نیاز به Monitoring و بهبود پایداری پایپلاین تست. |
| **عملکرد** | Functional | ۳ | محدودسازی نرخ (Rate Limiting) و مدیریت همزمانی در سطح دیتابیس انجام شده است. نیاز به Caching لایه سرویس. |
| **مستندسازی** | Minimal | ۲ | مستندات README و TODO وجود دارند اما OpenAPI/Swagger ناقص است. |

**سطح فعلی پروژه: Level 3 (MVP)**

---

## ۲. لیست TODO برای رسیدن به Production-Ready

### a. معماری و ساختار کد (High Priority)
- [ ] **یکپارچه‌سازی لایه Repository**: انتقال تمامی کوئری‌های Prisma به فایل‌های `.repo.ts` برای تمام ماژول‌ها جهت بهبود تست‌پذیری و قابلیت نگهداری.
- [ ] **الگوی Unit of Work**: پیاده‌سازی مکانیزم تراکنش‌های پیچیده به صورت متمرکز در سرویس‌ها بدون وابستگی مستقیم به Prisma Client در منطق تجاری.
- [ ] **بهبود سیستم Dependency Injection**: بررسی استفاده از یک IoC Container ساده برای مدیریت طول عمر سرویس‌ها (توصیه شده برای Scale بالا).

### b. تست و پوشش تست (High Priority)
- [ ] **افزایش Coverage به ۸۰٪+**: تمرکز روی تست‌های واحد برای `CommissionsService` و `AvailabilityService`.
- [ ] **تست‌های نفوذ خودکار**: اضافه کردن ابزارهای اسکن امنیتی در پایپلاین CI/CD.
- [ ] **Load Testing**: انجام تست فشار روی اندپوینت‌های عمومی (Public Booking) برای شناسایی Bottleneckها.

### c. امنیت و احراز هویت (Critical)
- [ ] **تکمیل سیستم Audit Logging**: پیاده‌سازی کامل سرویس ثبت وقایع حساس (تغییر نقش، لغو رزرو، تغییر قیمت) با استفاده از مدل موجود در دیتابیس.
- [ ] **Refresh Token Rotation**: پیاده‌سازی مکانیزم چرخش توکن برای امنیت بیشتر سشن‌ها.
- [ ] **مدیریت Secrets**: انتقال تمامی کلیدهای حساس به یک Secret Manager (مانند AWS Secrets Manager یا HashiCorp Vault) در محیط تولید.

### d. زیرساخت و CI/CD (Medium Priority)
- [ ] **مانیتورینگ و APM**: یکپارچه‌سازی با ابزارهایی مانند Sentry (برای خطاها) و Prometheus/Grafana (برای متریک‌ها).
- [ ] **تثبیت محیط تست**: حل مشکل Docker-in-Docker در CI و جداسازی کامل محیط تست از دیتابیس توسعه.
- [ ] **Backups**: پیاده‌سازی استراتژی پشتیبان‌گیری خودکار از دیتابیس (Daily Off-site Backups).

### e. عملکرد و بهینه‌سازی (Medium Priority)
- [ ] **لایه Caching (Redis)**: پیاده‌سازی کش برای اطلاعات سالن‌ها و سرویس‌ها در اندپوینت‌های عمومی برای کاهش بار دیتابیس.
- [ ] **بهینه‌سازی کوئری‌ها**: بررسی و اضافه کردن ایندکس‌های لازم برای گزارش‌های تحلیلی سنگین.
- [ ] **Image Optimization**: بهبود لایه آپلود تصاویر با استفاده از CDN و فرمت‌های مدرن مانند WebP.

### f. مستندسازی و مانیتورینگ (High Priority)
- [ ] **تکمیل OpenAPI/Swagger**: ارائه مستندات تعاملی برای API جهت استفاده توسعه‌دهندگان فرانت‌هند و شرکا.
- [ ] **مستندات استقرار (Deployment Guide)**: تدوین راهنمای گام‌به‌گام برای راه‌اندازی پروژه در محیط‌های مختلف (Staging/Production).

### g. UX و قابلیت توسعه (Low Priority)
- [ ] **Webhooks برای مشتریان**: امکان ارسال ایونت‌های بیزینسی به سیستم‌های خارجی.
- [ ] **سیستم قالب‌بندی ایمیل/SMS**: جداسازی منطق پیام‌ها از کد (Template Management).

---

## ۳. خلاصه نهایی و اولویت‌های آنی

*   **سطح فعلی پروژه**: Level 3 (MVP)
*   **درصد تکمیل برای Production-Ready**: ۷۰٪
*   **۳ اولویت برتر (بیشترین تاثیر)**:
    1.  **Audit Logging**: برای شفافیت و امنیت عملیات مالی و مدیریتی.
    2.  **Infrastructure Stability**: حل مشکلات CI و اضافه کردن Monitoring حرفه‌ای.
    3.  **Test Coverage**: تضمین عدم بروز Regression در هنگام توسعه فیچرهای جدید.
