# تحلیل ماژول سرویس (Service Module Analysis)

تاریخ: 2024-07-25

## 1) هدف و مسئولیت‌ها

ماژول سرویس، یکی از بخش‌های اصلی سیستم مدیریت سالن است. وظیفه اصلی این ماژول، تعریف و مدیریت خدماتی است که سالن ارائه می‌دهد. این ماژول به مدیران سالن اجازه می‌دهد تا کاتالوگ خدمات خود را به صورت دیجیتال مدیریت کرده و آن را برای رزرواسیون داخلی (توسط منشی) و آنلاین (توسط مشتری) در دسترس قرار دهند.

## 2) مدل داده (Data Model)

بر اساس فایل `prisma/schema.prisma`، مدل اصلی این ماژول `Service` است که ساختار زیر را دارد:

- **`Service`**:
    - `id (String)`: شناسه یکتای سرویس.
    - `salonId (String)`: شناسه سالنی که سرویس به آن تعلق دارد.
    - `name (String)`: نام سرویس (مثلاً: "اصلاح موی سر").
    - `durationMinutes (Int)`: مدت زمان ارائه سرویس به دقیقه.
    - `price (Int)`: قیمت سرویس.
    - `currency (String)`: واحد پول (مثلاً: "IRR").
    - `isActive (Boolean)`: وضعیت سرویس. اگر `false` باشد، سرویس غیرفعال است و قابل رزرو نیست.

- **`UserService` (جدول واسط)**:
    - این جدول، رابطه چندبه‌چند بین `User` (کارکنان) و `Service` را برقرار می‌کند.
    - مشخص می‌کند که کدام یک از کارکنان، صلاحیت ارائه کدام خدمات را دارند.

## 3) API Endpoints

بر اساس مستندات `sevra-api-spec-final.md`، دو دسته Endpoint برای این ماژول تعریف شده است:

### 3.1) Private API (برای پنل مدیریت)

این Endpointها برای استفاده در داشبورد مدیریتی سالن هستند و نیاز به احراز هویت و مجوز دسترسی (Role) دارند.

- `GET /api/v1/salons/{salonId}/services`
    - **توضیحات**: دریافت لیست تمام سرویس‌های یک سالن.
    - **مجوز دسترسی**: `MANAGER`, `RECEPTIONIST`, `STAFF`.
    - **فیلترها**: می‌توان بر اساس `isActive` فیلتر کرد.

- `POST /api/v1/salons/{salonId}/services`
    - **توضیحات**: ایجاد یک سرویس جدید.
    - **مجوز دسترسی**: `MANAGER`.
    - **بدنه درخواست (Payload)**: شامل `name`, `durationMinutes`, `price`, `currency`, و `isActive`.

- `GET /api/v1/salons/{salonId}/services/{serviceId}`
    - **توضیحات**: دریافت جزئیات یک سرویس خاص.
    - **مجوز دسترسی**: `MANAGER`, `RECEPTIONIST`, `STAFF`.

- `PATCH /api/v1/salons/{salonId}/services/{serviceId}`
    - **توضیحات**: ویرایش اطلاعات یک سرویس موجود.
    - **مجوز دسترسی**: `MANAGER`.

- `DELETE /api/v1/salons/{salonId}/services/{serviceId}`
    - **توضیحات**: غیرفعال کردن یک سرویس (حذف نرم یا Soft Delete). این عملیات رکورد را از دیتابیس حذف نمی‌کند، بلکه فیلد `isActive` آن را `false` می‌کند.
    - **مجوز دسترسی**: `MANAGER`.

### 3.2) Public API (برای وب‌سایت عمومی)

این Endpoint برای نمایش خدمات سالن به مشتریان در وب‌سایت عمومی یا اپلیکیشن رزرو آنلاین استفاده می‌شود.

- `GET /api/v1/public/salons/{salonSlug}/services`
    - **توضیحات**: دریافت لیست سرویس‌های *فعال* (`isActive: true`) یک سالن برای نمایش عمومی.
    - **مجوز دسترسی**: بدون نیاز به احراز هویت.
    - **شناسه**: از `salonSlug` (نامک عمومی سالن) به جای `salonId` استفاده می‌شود.

## 4) ارتباط با سایر ماژول‌ها

- **ماژول کاربران/کارکنان (Users/Staff)**: از طریق جدول `UserService` مشخص می‌شود که هر کارمند چه خدماتی را ارائه می‌دهد.
- **ماژول رزرواسیون (Bookings)**: هنگام ثبت رزرو، یک `serviceId` انتخاب می‌شود. اطلاعاتی مانند مدت زمان و قیمت سرویس (`duration` و `price`) در رزرو ثبت (snapshot) می‌شود.
- **ماژول در دسترس بودن (Availability)**: برای محاسبه زمان‌های خالی یک کارمند، مدت زمان سرویس (`durationMinutes`) یک پارامتر کلیدی است.

---

این تحلیل یک دید کلی و کامل از نیازمندی‌ها و طراحی ماژول سرویس ارائه می‌دهد و می‌تواند به عنوان راهنما برای شروع فرآیند پیاده‌سازی استفاده شود.
