حتماً — متن «محدوده MVP» رو بر اساس اسکیمایی که فرستادی (CRM دو لایه، رزرو آنلاین/حضوری، شیفت، جلوگیری از تداخل، پرداخت و وضعیت‌ها، و **Commission جدید**) آپدیت کردم. همزمان چند مورد ضروری مثل وضعیت‌های رزرو/پرداخت و تنظیمات آنلاین‌بوکینگ رو هم دقیق‌تر کردم.

---

# پلتفرم مدیریت سالن – محدوده MVP (Updated)

نسخه: 0.2
وضعیت: MVP قابل استفاده واقعی
هدف: حداقل امکانات لازم برای شروع استفاده در سالن + پشتیبانی رزرو آنلاین ساده + پرداخت پایه + کمیسیون (اختیاری)

---

## 1) احراز هویت و مدیریت دسترسی (حداقلی)

### نقش‌ها

* مدیر (MANAGER)
* منشی (RECEPTIONIST)
* کارکن (STAFF)

### امکانات

* ورود / خروج
* مدیریت کاربران در هر سالن:

  * ایجاد کاربر، ویرایش، غیرفعال‌سازی
  * تعیین نقش
* کنترل دسترسی ساده بر اساس نقش:

  * مدیر: همه چیز
  * منشی: رزرو + مشتری + پرداخت
  * کارکن: مشاهده رزروهای خود

---

## 2) مدیریت خدمات

### امکانات

* ایجاد / ویرایش / غیرفعال‌سازی خدمت (حذف فیزیکی در MVP لازم نیست)
* مشخصات خدمت:

  * نام
  * مدت زمان (دقیقه)
  * قیمت ثابت
  * ارز (مثلاً IRR)
  * وضعیت فعال/غیرفعال
* اتصال خدمت به کارکن (UserService)
* لیست خدمات (فیلتر فعال/غیرفعال)

---

## 3) مدیریت کارکنان

### امکانات

* ایجاد / ویرایش / غیرفعال‌سازی کارکن
* مشخصات:

  * نام و نام خانوادگی
  * شماره تماس
  * نقش
* تعیین خدمات قابل ارائه برای هر کارکن
* تعریف شیفت کاری ساده (Shift):

  * روز هفته (0..6)
  * ساعت شروع/پایان
  * فعال/غیرفعال

---

## 4) مدیریت مشتریان (CRM پایه)

### ساختار (طبق اسکیما)

* هویت سراسری مشتری: **CustomerAccount** (کل سیستم با شماره موبایل یکتا)
* پروفایل در هر سالن: **SalonCustomerProfile** (نام نمایشی/یادداشت مخصوص همان سالن)

### امکانات

* ایجاد/ویرایش مشتری:

  * شماره تماس (کلیدی)
  * نام (اختیاری/نمایشی)
  * یادداشت مخصوص سالن
* پروفایل مشتری در سالن
* تاریخچه رزروهای مشتری (در همان سالن)

---

## 5) سیستم رزرو (هسته اصلی)

### منابع رزرو

* حضوری (IN_PERSON)
* آنلاین (ONLINE)

### ایجاد رزرو

* ثبت رزرو توسط منشی
* ثبت رزرو آنلاین (نسخه ساده):

  * فقط اگر `allowOnlineBooking = true`
  * اگر `onlineBookingAutoConfirm = true` → رزرو مستقیم تایید می‌شود
  * در غیر این صورت → رزرو با وضعیت در انتظار تایید ایجاد می‌شود

### مشخصات رزرو

* مشتری (Profile + Account)
* خدمت
* کارکن
* زمان شروع/پایان
* یادداشت

### تقویم و قوانین

* تقویم بر اساس شیفت کارکن
* جلوگیری از تداخل زمانی (طبق تنظیمات `preventOverlaps`)
* نمایش رزروها:

  * لیست
  * تقویم

### وضعیت رزرو (MVP)

* در انتظار تایید (PENDING)
* تایید شده (CONFIRMED)
* انجام شده (DONE)
* لغو شده (CANCELED)
* *(NO_SHOW می‌تواند بعد از MVP فعال شود، ولی اسکیما آماده است)*

---

## 6) مدیریت مالی پایه (Payments)

### امکانات

* ثبت پرداخت برای هر رزرو
* روش پرداخت:

  * نقدی (CASH)
  * کارت (CARD)
  * آنلاین (ONLINE)
* وضعیت پرداخت رزرو (BookingPaymentState):

  * پرداخت نشده (UNPAID)
  * پرداخت شده (PAID)
  * *(پرداخت جزئی/اضافه‌پرداخت/ریفاند در MVP اختیاری — اسکیما آماده است)*

### گزارش‌ها

* گزارش درآمد روزانه (جمع پرداخت‌های روز)
* گزارش درآمد ماهانه (جمع پرداخت‌های ماه)

---

## 7) کمیسیون رزرو آنلاین (اختیاری ولی آماده)

### هدف

اگر سالن از رزرو آنلاین کمیسیون دریافت می‌کند.

### امکانات MVP

* تعریف سیاست کمیسیون برای سالن (SalonCommissionPolicy):

  * درصدی (PERCENT) یا ثابت (FIXED)
  * فقط رزرو آنلاین یا همه رزروها
  * حداقل کارمزد (اختیاری)
  * فعال/غیرفعال
* ثبت رکورد کمیسیون برای رزرو (BookingCommission):

  * مبلغ پایه
  * مبلغ کمیسیون محاسبه‌شده
  * وضعیت: PENDING → (در مراحل بعد ACCRUED/CHARGED…)
* *(پرداخت کمیسیون به‌صورت CommissionPayment بهتر است بعد از MVP فعال شود؛ فعلاً می‌تواند فقط ثبت حسابداری باشد)*

---

## 8) داشبورد پایه

### امکانات

* تعداد رزروهای امروز
* درآمد امروز
* رزروهای پیش‌رو (مثلاً 7 روز آینده)
* آمار عددی ساده (بدون نمودار)

---

## 9) تنظیمات سیستم (حداقلی)

### امکانات

* تنظیمات سالن:

  * نام سالن
  * منطقه زمانی (timeZone)
  * ساعات کاری عمومی (workStartTime / workEndTime)
* قوانین رزرو:

  * جلوگیری از تداخل رزروها (preventOverlaps)
* تنظیمات رزرو آنلاین:

  * فعال/غیرفعال کردن رزرو آنلاین (allowOnlineBooking)
  * تایید خودکار رزرو آنلاین (onlineBookingAutoConfirm)
